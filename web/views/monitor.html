<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Gearman worker and job information</title>

  <!-- Add this to <head> -->
  <link href="/assets/bootstrap.min.css" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="/assets/bootstrap-vue.css"/>
  <style type="text/css">
    @media (min-width: 576px)
    .bd-footer {
        text-align: left;
    }
    .bd-footer {
        padding: 4rem 0;
        margin-top: 4rem;
        font-size: 85%;
        text-align: center;
        background-color: #f7f7f7;
    }
    .bd-footer-links {
        padding-left: 0;
        margin-bottom: 1rem;
    }
    .bd-footer-links li {
        display: inline-block;
    }
    .bd-footer a {
        font-weight: 500;
        color: #464a4c;
    }
    .job-names {
      margin: 0 .5em;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
    <b-navbar toggleable type="inverse" variant="success">
        <div class="container">
      <b-nav-toggle target="nav_collapse"></b-nav-toggle>

      <b-link class="navbar-brand" to="#">
        <span>Gearmand servers information</span>
      </b-link>

      <b-collapse is-nav id="nav_collapse">

        <!-- <b-nav is-nav-bar>
          <b-nav-item>Support</b-nav-item>
          <b-nav-item>Docs</b-nav-item>
          <b-nav-item>Contact Us</b-nav-item>
        </b-nav> -->

        <b-nav is-nav-bar class="ml-auto">

          <!-- Navbar dropdowns -->
         <!--  <b-nav-item-dropdown text="Lang" right-alignment>
            <b-dropdown-item to="#">EN</b-dropdown-item>
            <b-dropdown-item to="#">ZH-CN</b-dropdown-item>
          </b-nav-item-dropdown> -->

          <!-- <b-nav-item-dropdown right-alignment>

            <template slot="text">
              <span style="font-weight: bold;">User</span>
            </template>

            <b-dropdown-item to="#">Profile</b-dropdown-item>
            <b-dropdown-item to="#">Signout</b-dropdown-item>
          </b-nav-item-dropdown> -->

        </b-nav>
      </b-collapse>
      </div>
    </b-navbar>
    </header>
    <hr>

    <div class="container">

      <!-- card -->
      <b-card
          :inverse="false"
          class="mb-2"
          header="Gearmand servers information"
          variant="default"
      >
          <!-- title="Card title" -->
          <!-- sub-title="Card subtitle" -->
        <div class="justify-content-center my-1 row">
          <b-form-fieldset horizontal label="Filter" class="col-6" :label-size="2">
            <b-form-input v-model="svrFilter" placeholder="Type to Search"></b-form-input>
          </b-form-fieldset>
        </div>

        <!-- Main table element -->
        <b-table striped bordered hover
          :items="servers"
          :fields="serversFields"
          :filter="svrFilter">
          <template slot="address" scope="item">
            <code>{{item.value}}</code>
          </template>
          <template slot="version" scope="item">
            <code>{{item.value}}</code>
          </template>
        </b-table>
      </b-card>

      <!-- Tabs with card integration -->
      <b-card no-block>
        <b-tabs small pills card ref="tabs" v-model="tabIndex">
          <b-tab title="Jobs information(Status)">
            <div class="justify-content-center my-1 row">
              <b-form-fieldset horizontal label="Filter" class="col-6" :label-size="2">
                <b-form-input v-model="stsFilter" placeholder="Type to Search"></b-form-input>
              </b-form-fieldset>
            </div>

            <!-- Main table element -->
            <b-table small bordered hover
              head-variant="success"
              :items="statusInfo"
              :fields="statusFields"
              :current-page="stsCurPage"
              :per-page="stsPerPage"
              :filter="stsFilter"
            >
              <template slot="job_name" scope="item">
                <span class="badge badge-success">{{item.value}}</span>
              </template>
              <template slot="in_queue" scope="item">
                {{item.value}}
              </template>
              <template slot="in_running" scope="item">
                {{item.value}}
              </template>
              <template slot="actions" scope="item">
                <b-btn size="sm" @click="details(item)">Details</b-btn>
              </template>
            </b-table>

            <div class="justify-content-center row my-1">
              <b-form-fieldset horizontal label="Rows per page" class="col-4" :label-size="7">
                <b-form-select :options="[{text:10,value:10},{text:15,value:15}]" v-model="stsPerPage">
                </b-form-select>
              </b-form-fieldset>
              <b-form-fieldset horizontal label="Pagination" class="col-8" :label-size="2">
                <b-pagination size="sm" :total-rows="this.statusInfo.length" :per-page="stsPerPage" v-model="stsCurPage" />
              </b-form-fieldset>
            </div>

          </b-tab>
          <!-- Workers -->
          <b-tab title="Workers information">
            <div class="justify-content-center my-1 row">
              <b-form-fieldset horizontal label="Filter" class="col-6" :label-size="2">
                <b-form-input v-model="wkrFilter" placeholder="Type to Search"></b-form-input>
              </b-form-fieldset>
            </div>

            <!-- Main table element -->
            <b-table small bordered hover
              head-variant="success"
              :items="workersInfo"
              :fields="workersFields"
              :current-page="wkrCurPage"
              :per-page="wkrPerPage"
              :filter="wkrFilter"
            >
              <template slot="ip" scope="item">
                <code>{{item.value}}</code>
              </template>
              <template slot="job_names" scope="item">
                <code v-for="name in item.value">{{ name }}</code>
              </template>
              <template slot="actions" scope="item">
                <b-btn size="sm" @click="details(item)">Details</b-btn>
              </template>
            </b-table>

            <div class="justify-content-center row my-1">
              <b-form-fieldset horizontal label="Rows per page" class="col-4" :label-size="7">
                <b-form-select :options="[{text:10,value:10},{text:15,value:15}]" v-model="wkrPerPage">
                </b-form-select>
              </b-form-fieldset>
              <b-form-fieldset horizontal label="Pagination" class="col-8" :label-size="2">
                <b-pagination size="sm" :total-rows="this.workersInfo.length" :per-page="wkrPerPage" v-model="wkrCurPage" />
              </b-form-fieldset>
            </div>
          </b-tab>
        </b-tabs>

      </b-card>
    </div>

    <footer class="bd-footer text-muted">
      <div class="container">
        <ul class="bd-footer-links">
          <li><a href="/" class="nuxt-link-active">Home</a></li>
          <li><a href="https://github.com/inhere/php-gearman-manager" target="_blank">GitHub</a></li>
        </ul>
        <p>
          welcome
        </p>
      </div>
    </footer>
  </div>

  <!-- Add this after vue.js -->
  <script src="/assets/vue.min.js"></script>
  <script src="/assets/polyfill.min.js"></script>
  <script src="/assets/tether.min.js"></script>
  <script src="/assets/bootstrap-vue.js"></script>
  <script>
    // 务必在加载 Vue 之后，立即同步设置以下内容
    Vue.config.devtools = true

    let vm = new Vue({
      el: '#app',
      data: {
        statusInfo: <?= $statusInfo ?>,
        statusFields: {
          job_name: {
            label: 'Job name',
            sortable: true
          },
          server: {
            label: 'Server name',
            sortable: true
          },
          in_queue: {
            label: 'in queue'
          },
          in_running: {
            label: 'in running'
          },
          capable_workers: {
            label: 'capable workers'
          }
        },
        workersInfo: <?= $workersInfo ?>,
        workersFields: {
          id: {
            label: 'ID',
            sortable: true
          },
          ip: {
            label: 'IP'
          },
          server: {
            label: 'Server'
          },
          job_names: {
            label: 'Job list of the worker'
          }
        },
        servers: <?= $servers ?>,
        serversFields: {
          index: {
            label: 'Index',
            sortable: true
          },
          name: {
            label: 'Name',
            sortable: true
          },
          address: {
            label: 'Address',
          },
          version: {
            label: 'Version',
          }
        },
        stsCurPage: 1,
        stsPerPage: 10,
        stsFilter: null,
        wkrCurPage: 1,
        wkrPerPage: 10,
        wkrFilter: null,
        tabIndex: null,
        svrFilter: null
      },
      methods: {
        details(item) {
          alert(JSON.stringify(item));
        }
      }
    })
  </script>
</body>
</html>
